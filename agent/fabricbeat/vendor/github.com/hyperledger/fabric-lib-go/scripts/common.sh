#
# Copyright IBM Corp. All Rights Reserved.
#
# SPDX-License-Identifier: Apache-2.0
#

#
# This file contains some common functions that are used by other scripts.
#

join_by() {
    local IFS="$1"
    shift
    echo "$*"
}

filter_generated_files() {
    for f in $@; do
        head -n2 $f | grep -qE 'Code generated by.*DO NOT EDIT' || echo $f
    done
}

git_diff() {
    git diff --name-only --diff-filter ACMRTUXB ${1:-HEAD}
}

git_last_changed() {
    local changed=$(git_diff HEAD)
    if [ -z "$changed" ]; then
        changed=$(git_diff HEAD^)
    fi
    echo ${changed}
}

git_last_changed_excluding() {
    git_last_changed | grep -Ev $(join_by '|' $*) || true
}
